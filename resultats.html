<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vos Résultats et Programmes Recommandés</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #f4f7f6;
            color: #333;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
        }
        .container {
            max-width: 800px;
            margin: 20px auto;
        }
        .section {
            background-color: #ffffff;
            padding: 30px 40px;
            border-radius: 12px;
            box-shadow: 0 8px 30px rgba(0,0,0,0.08);
            margin-bottom: 25px;
        }
        .header {
            text-align: center;
            border-bottom: 1px solid #eee;
            padding-bottom: 20px;
            margin-bottom: 30px;
        }
        h1, h2, h3 {
            color: #2c3e50;
        }
        h1 { font-size: 2.2rem; color: #007bff; }
        h2 { text-align: center; font-size: 1.8rem; margin-bottom: 30px; }
        h3 { color: #007bff; }

        .results-summary {
            display: flex;
            justify-content: space-around;
            text-align: center;
            margin-bottom: 30px;
            flex-wrap: wrap; /* Allows elements to wrap on smaller screens */
        }
        .result-box {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            width: 45%; /* Adjusted for space for IMC */
            margin-bottom: 15px; /* Space between boxes on small screens */
        }
        .result-box.imc {
            width: 95%; /* IMC takes more space, centered */
            margin-top: 10px;
            background-color: #e6f7ff; /* Different color for IMC */
            border: 1px solid #91d5ff;
        }
        .result-box h3 { margin-top: 0; color: #555; font-size: 1rem; }
        .result-value { font-size: 2.8em; font-weight: 700; color: #2c3e50; }
        .unit { font-size: 1rem; color: #777; }
        .imc-category {
            font-size: 1.1rem;
            font-weight: 600;
            margin-top: 10px;
            color: #333;
        }

        .program-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 25px;
        }
        .card {
            background-color: #fff;
            border: 1px solid #ddd;
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            padding: 25px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            transition: transform 0.3s, box-shadow 0.3s;
            position: relative;
        }
        .card:hover {
            transform: translateY(-8px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.12);
        }
        .card-image {
            width: 100%;
            max-height: 180px; /* Set a maximum height */
            border-radius: 8px 8px 0 0;
            margin-bottom: 15px;
            object-fit: contain; /* Ensures the entire image is visible, may add some empty space */
        }
        .card-content {
            flex-grow: 1;
        }
        .card-title {
            font-size: 1.3rem;
            font-weight: 600;
            margin-top: 0;
            margin-bottom: 10px;
        }
        .card-details {
            font-size: 0.95rem;
            color: #555;
            margin-bottom: 15px;
        }
        .card-price {
            font-size: 1.8rem;
            font-weight: 700;
            color: #28a745;
            margin-bottom: 15px;
        }
        .buy-button {
            display: block;
            background-color: #ff7f50;
            color: white !important;
            padding: 12px 20px;
            text-align: center;
            text-decoration: none;
            border-radius: 8px;
            font-weight: 700;
            margin-top: auto;
            transition: background-color 0.3s;
        }
        .buy-button:hover {
            background-color: #e66a3d;
        }
        .recommended-badge {
            position: absolute;
            top: 15px;
            right: -10px;
            background-color: #007bff;
            color: white;
            padding: 5px 15px;
            font-size: 0.8rem;
            font-weight: 700;
            border-radius: 5px;
            transform: rotate(30deg);
        }
        /* Styles pour l'estimation de la perte de poids - MISE EN ÉVIDENCE */
        .estimated-loss {
            font-weight: 700; /* Plus gras */
            font-size: 1.1em; /* Un peu plus grand */
            color: #d9534f; /* Rouge pour attirer l'attention (peut être changé) */
            background-color: #ffe0e0; /* Fond légèrement coloré */
            padding: 8px 10px; /* Espacement interne */
            border-radius: 5px; /* Coins arrondis */
            margin-top: 10px;
            margin-bottom: 15px;
            text-align: center;
            border: 1px solid #d9534f; /* Bordure pour plus de visibilité */
            box-shadow: 0 2px 5px rgba(0,0,0,0.1); /* Légère ombre */
        }

        /* Media Queries for responsiveness */
        @media (max-width: 600px) {
            .results-summary .result-box {
                width: 100%; /* Boxes take full width on small screens */
            }
        }
    </style>
</head>
<body>

    <div class="container">
        <div class="section header">
            <h1>Vos Résultats Personnalisés</h1>
            <div class="results-summary">
                <div class="result-box">
                    <h3>Métabolisme de Base</h3>
                    <p class="result-value" id="bmr-result">0</p>
                    <p class="unit">Calories / jour</p>
                </div>
                <div class="result-box">
                    <h3>Maintien du Poids</h3>
                    <p class="result-value" id="tdee-result">0</p>
                    <p class="unit">Calories / jour</p>
                </div>
                <div class="result-box imc">
                    <h3>Votre Indice de Masse Corporelle (IMC)</h3>
                    <p class="result-value" id="imc-result">0.0</p>
                    <p class="unit">kg/m²</p>
                    <p class="imc-category" id="imc-category"></p>
                </div>
            </div>
            <p>Ce besoin journalier est la base pour définir votre stratégie. Pour perdre du poids, vous devez consommer moins de calories que ce montant.</p>
        </div>

        <div class="section" id="main-recommendation">
            <h2>Votre Programme Idéal Pour Démarrer</h2>
            <div id="recommended-program-container" class="program-cards">
                </div>
        </div>

        <div class="section" id="complete-challenge">
             <h2>Notre Recommandation Phare : Le Défi Complet</h2>
            <div id="challenge-7-weeks-container" class="program-cards">
                </div>
        </div>


        <div class="section" id="other-options">
            <h2>Toutes Nos Options Pour la Perte de Poids</h2>
            <div id="other-programs-container" class="program-cards">
                </div>
        </div>
    </div>

    <script>
        // Base de données des programmes
        const programs = [
            { id: 1, name: "10 jours pour sécher", price: "10,99€", calories: 1300, duration: "10 jours", description: "Idéal pour un démarrage rapide et une perte de poids visible en peu de temps.", link: "https://shop.beacons.ai/kcoaching/bfc42c3d-a1a0-42c9-82bc-395ddffcb3bc", imageUrl: "10 JOURS POUR SECHER.PNG" },
            { id: 2, name: "14 jours pour sécher", price: "14,99€", calories: 1300, duration: "14 jours", description: "Prolongez l'effort pour des résultats plus consolidés avec ce plan efficace.", link: "https://shop.beacons.ai/kcoaching/cf28c7c7-cbad-44c6-b3cd-59419c8163d3", imageUrl: "14 JOURS POUR SECHER.PNG" },
            { id: 3, name: "Défi 14 jours", price: "14,99€", calories: 1400, duration: "14 jours", description: "Un équilibre parfait entre un apport calorique modéré et une perte de poids efficace.", link: "https://shop.beacons.ai/kcoaching/5b5379d0-cd57-4068-87b3-8aa393fa4824", imageUrl: "DEFI 14 JOURS.PNG" },
            { id: 4, name: "Challenge 4 semaines", price: "19,99€", calories: 1500, duration: "4 semaines", description: "Un plan sur un mois pour transformer votre silhouette de manière durable.", link: "https://shop.beacons.ai/kcoaching/8d04e33c-a3c9-4e77-8e1d-5d4faa4d15ce", imageUrl: "CHALLENGE 4 SEMAINES.PNG" },
            { id: 5, name: "Challenge 7 semaines", price: "29,99€", calories: "Variable", duration: "7 semaines", description: "La solution la plus complète avec une variation de calories pour décupler les résultats et éviter la stagnation.", link: "https://shop.beacons.ai/kcoaching/5fee0cd5-b961-4699-b2c7-f73591d9bfbb", imageUrl: "CHALLENGE 7 SEMAINES.PNG" }
        ];

        // Function to determine the IMC category
        function getIMCCategory(imc) {
            if (imc < 18.5) return "Insuffisance pondérale (maigreur)";
            if (imc >= 18.5 && imc < 25) return "Poids normal";
            if (imc >= 25 && imc < 30) return "Surpoids";
            if (imc >= 30 && imc < 35) return "Obésité modérée";
            if (imc >= 35 && imc < 40) return "Obésité sévère";
            return "Obésité morbide ou massive";
        }

        // Function to calculate estimated weight loss
        function calculateEstimatedLoss(tdee, programCalories) {
            const CALORIES_PER_KG_FAT = 7700; // Approximative calories in 1 kg of fat
            const DAYS_IN_3_MONTHS = 90; // Approximation for 3 months

            let dailyCaloricIntake;
            if (programCalories === "Variable") {
                dailyCaloricIntake = 1350; // Assumed effective average intake for calculation
            } else {
                dailyCaloricIntake = programCalories;
            }

            const dailyDeficit = tdee - dailyCaloricIntake;

            if (dailyDeficit <= 0) {
                return "Pas de perte estimée (pas de déficit calorique suffisant)";
            }

            const totalDeficit = dailyDeficit * DAYS_IN_3_MONTHS;
            const estimatedLossKg = totalDeficit / CALORIES_PER_KG_FAT;

            return `~${estimatedLossKg.toFixed(1)} kg`; // Display 1 decimal place
        }

        // Function to create an HTML program card
        function createProgramCard(program, isRecommended = false) {
            return `
                <div class="card">
                    ${isRecommended ? '<div class="recommended-badge">Recommandé</div>' : ''}
                    ${program.imageUrl ? `<img src="${program.imageUrl}" alt="${program.name}" class="card-image">` : ''}
                    <div class="card-content">
                        <h3 class="card-title">${program.name}</h3>
                        <p class="card-details">
                            <strong>Calories :</strong> ${program.calories === 'Variable' ? 'Progressives' : program.calories + ' kcal/jour'}<br>
                            <strong>Durée :</strong> ${program.duration}
                        </p>
                        <p>${program.description}</p>
                    </div>
                    <div class="card-price">${program.price}</div>
                    <p class="estimated-loss" id="estimated-loss-${program.id}"></p> <a href="${program.link}" class="buy-button">Choisir ce programme</a>
                </div>
            `;
        }

        // Execute code when the window has fully loaded
        window.addEventListener('load', function() {
            const params = new URLSearchParams(window.location.search);
            const bmr = parseInt(params.get('bmr'));
            const tdee = parseInt(params.get('tdee'));
            const weight = parseFloat(params.get('weight'));
            const height = parseFloat(params.get('height'));

            if (isNaN(tdee) || isNaN(weight) || isNaN(height)) {
                window.location.href = 'index.html';
                return;
            }

            document.getElementById('bmr-result').textContent = bmr;
            document.getElementById('tdee-result').textContent = tdee;

            const heightInMeters = height / 100;
            const imc = weight / (heightInMeters * heightInMeters);
            document.getElementById('imc-result').textContent = imc.toFixed(1);
            document.getElementById('imc-category').textContent = getIMCCategory(imc);

            // Logic for main program recommendation
            const recommendedContainer = document.getElementById('recommended-program-container');
            let recommendedProgramHTML = ''; // Utilisez une variable temporaire pour construire le HTML

            if (tdee >= 1600 && tdee < 1800) {
                const program1 = programs.find(p => p.id === 1);
                const program2 = programs.find(p => p.id === 2);
                if (program1) recommendedProgramHTML += createProgramCard(program1, true);
                if (program2) recommendedProgramHTML += createProgramCard(program2, true);
            } else if (tdee >= 1800 && tdee < 2000) {
                const program3 = programs.find(p => p.id === 3);
                if (program3) recommendedProgramHTML += createProgramCard(program3, true);
            } else if (tdee >= 2000) {
                const program4 = programs.find(p => p.id === 4);
                if (program4) recommendedProgramHTML += createProgramCard(program4, true);
            } else { // TDEE < 1600
                const program1 = programs.find(p => p.id === 1);
                if (program1) {
                    recommendedProgramHTML = `
                        ${createProgramCard(program1, true)}
                        <p style="text-align:center; margin-top:15px; grid-column: 1 / -1;">Avec votre métabolisme, un programme très bas en calories est nécessaire pour une perte de poids efficace.</p>
                    `;
                }
            }
            recommendedContainer.innerHTML = recommendedProgramHTML;


            // Always display the 7-week challenge as a featured recommendation
            const challenge7Weeks = programs.find(p => p.id === 5);
            document.getElementById('challenge-7-weeks-container').innerHTML = createProgramCard(challenge7Weeks, true);

            // Display other programs (those not already recommended and not the 7-week challenge)
            const otherContainer = document.getElementById('other-programs-container');
            const allRecommendedAndChallengeIds = (recommendedProgramHTML !== '' ? recommendedIds : []).concat([5]); // Fix for getting all IDs
            otherContainer.innerHTML = programs.filter(p => !allRecommendedAndChallengeIds.includes(p.id)).map(p => createProgramCard(p)).join('');

            // Calculate and display weight loss for ALL programs immediately
            if (!isNaN(tdee)) {
                programs.forEach(program => {
                    const estimatedLossText = calculateEstimatedLoss(tdee, program.calories);
                    const lossElement = document.getElementById(`estimated-loss-${program.id}`);
                    if (lossElement) {
                        lossElement.textContent = `Perte estimée sur 3 mois : ${estimatedLossText}`;
                    }
                });
            }
        });
    </script>

</body>
</html>
